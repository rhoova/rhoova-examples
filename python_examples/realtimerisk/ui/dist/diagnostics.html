<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>WS Diagnostics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body{font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;max-width:900px;margin:2rem auto;padding:0 1rem}
    .row{display:flex;gap:.5rem;flex-wrap:wrap}
    input,button{padding:.5rem .75rem;border:1px solid #ddd;border-radius:.5rem;font-size:14px}
    button{cursor:pointer}
    #status{font-weight:600}
    pre{background:#f7f7f7;border:1px solid #eee;padding:1rem;border-radius:.5rem;max-height:300px;overflow:auto}
    .ok{color:green}.bad{color:#b00020}
  </style>
</head>
<body>
  <h1>WebSocket Diagnostics</h1>
  <p>Use this to sanity‚Äëcheck your backend (<code>ws://localhost:8000/‚Ä¶</code>) independently of the main UI.</p>
  <div class="row">
    <input id="wsUrl" type="text" size="60" value="ws://localhost:8000/ws" />
    <button id="btnConnect">Connect</button>
    <button id="btnDisconnect">Disconnect</button>
    <span id="status" class="bad">disconnected</span>
  </div>
  <div class="row" style="margin-top:1rem">
    <input id="txtSend" type="text" size="60" placeholder='{"ping":"hello"}'/>
    <button id="btnSend">Send</button>
  </div>
  <h3>Log</h3>
  <pre id="log"></pre>
  <script type="module">
    let WS = null;
    const el = (id)=>document.getElementById(id);
    const log = (msg)=>{ el('log').textContent += msg + "\n"; el('log').scrollTop = el('log').scrollHeight; };
    const setStatus = (ok)=>{ el('status').textContent = ok ? "connected" : "disconnected"; el('status').className = ok ? "ok" : "bad"; };
    function connect(url){
      try { if (WS) WS.close(); } catch {}
      WS = new WebSocket(url);
      log("connecting to " + url);
      WS.onopen = () => { setStatus(true); log("‚úÖ open"); };
      WS.onmessage = (e) => { log("üì© " + e.data); };
      WS.onerror = (e) => { setStatus(false); log("‚ö†Ô∏è error (check 403 path/auth/CORS on server)"); };
      WS.onclose = (e) => { setStatus(false); log("üîå closed"); };
    }
    el('btnConnect').onclick = ()=>connect(el('wsUrl').value.trim());
    el('btnDisconnect').onclick = ()=>{ try { WS && WS.close(); } catch{} };
    el('btnSend').onclick = ()=>{
      try { WS && WS.send(el('txtSend').value); log("‚û°Ô∏è sent"); } catch { log("send failed"); }
    };
    // Allow quick channel switch: ?path=/ws/yield
    const params = new URLSearchParams(location.search);
    if (params.has("path")) {
      el('wsUrl').value = "ws://localhost:8000" + params.get("path");
    }
  </script>
</body>
</html>
